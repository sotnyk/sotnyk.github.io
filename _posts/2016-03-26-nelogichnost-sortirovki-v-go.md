---
id: 1601
title: 'Нелогичность сортировки в Go'
date: '2016-03-26T16:51:37+00:00'
author: serge
layout: post
guid: 'http://sotnyk.com/?p=1601'
permalink: /2016/03/26/nelogichnost-sortirovki-v-go/
---

[![golang.sh-600x600](https://sotnyk.github.io/wp-content/uploads/2015/11/golang.sh-600x600-300x300.png)](https://sotnyk.github.io/wp-content/uploads/2015/11/golang.sh-600x600.png)

На днях разбирался с одной непонятной ошибкой в учебном проекте. Вроде бы все правильно перенес из аналогичного примера на Питоне, а не работает. Причина оказалась банальна. Прочитав, как работает сортировка слайса в Go, я написал аналогичное (как мне казалось) выражение для обратной сортировки. У меня была сортировка структуры – там нужно реализовать небольшой интерфейс из трех методов, но это не особо важно, поэтому [я покажу на примере сортировки слайса с плавающей запятой](https://play.golang.org/p/RuL5Zqao_u) (один из трех, для которых этот интерфейс реализован заранее).

Итак, сортировка идет следующим образом:

```golang
a := sort.Float64Slice{-1, 1, 0, 3, -2}
fmt.Println(a)
sort.Sort(a)
fmt.Println(a)
```

Получаем:

```
[-1 1 0 3 -2]
[-2 -1 0 1 3]
```

Пока все логично. Особенностью является то, что сортировка идет «по месту» – т.е., нет выделения нового слайса. Это вполне логично с учетом нацеленности Go и его стандартной библиотеки на эффективность.

И вот, нам нужно отсортировать этот же массив в обратном порядке. Поскольку есть функция sort.Reverse, принимающая тот же параметр, что и Sort, то я, не особо читая пояснения, написал такое:

```sort.Reverse(a)```

После долгих розысков в совсем других местах (не мог подумать, что проблема может быть здесь), оказалось, что этот метод ничего не меняет в слайсе! На самом деле, он возвращает интерфейс, в котором метод Less, используемый в сортировке, меняет свой знак на противоположный. Правильный код выглядит вот так:

```sort.Sort(sort.Reverse(a))```

Как по мне – это одна из немногих нелогичностей в Go. Исходя из того, что данную функцию вряд ли кто-то будет использовать самостоятельно, её лучше бы все же было реализовать монолитно – что-то вроде sort.SortReverse(a), внутри которой спрятать это конструирование интерфейса обратной сортировки.

Что можно было бы добавить из отрицательных впечатлений? Несколько раз хотелось бы использовать отсутствующий в Go тетранарный оператор ?:. Не знаю, почему его исключили. Конечно, при желании его можно использовать для написания плохочитаемого кода, но так можно использовать многие конструкции. В то же время, при правильном использовании, он делает код чище.

А вот пара других моих опасений не оправдалась. UTF8 во внутреннем представлении строк пока не доставили особых хлопот. Также, пока особо не возникала необходимость в использовании шаблонов – мощь встроенных в язык слайсов и словарей позволяла без проблем обходиться ими. Конечно, это первые впечатления – что-то определенное можно будет сказать, только поработав с языком в реальном и достаточно большом проекте.
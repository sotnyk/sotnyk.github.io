---
id: 1236
title: '–°–ª—É—á–∞–∏ –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏ 2. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–º.'
date: '2012-09-21T18:40:40+00:00'
author: serge
layout: post
guid: 'http://sotnyk.com/?p=1236'
permalink: /2012/09/21/sluchai-iz-praktiki-2-refaktorim/
---

![](http://localhost/wp-content/uploads/2012/09/Sluchai-is-praktiki-198x300.jpg "Sluchai-is-praktiki")–ù–µ–±–æ–ª—å—à–æ–µ –ª–∏—Ä–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å—Ç—É–ø–ª–µ–Ω–∏–µ. –î–æ–ª–≥–æ–µ –≤—Ä–µ–º—è —ç—Ç–æ —Å–ª–æ–≤–æ –±–æ–ª—å—à–µ —á–∏—Ç–∞–ª, —á–µ–º –ø—Ä–æ–∏–∑–Ω–æ—Å–∏–ª –∏–ª–∏ —Å–ª—ã—à–∞–ª. –ò –ø–æ–ø–µ—Ä–≤–∞ –ø—Ä–∏—Å–ø–æ—Å–æ–±–∏–ª—Å—è –µ–≥–æ –ø—Ä–æ–∏–∑–Ω–æ—Å–∏—Ç—å –ø—Ä–æ —Å–µ–±—è —Å —É–¥–∞—Ä–µ–Ω–∏–µ–º –Ω–∞ ‚Äú–æ‚Äù ‚Äì —Ä–µ—Ñ–∞–∫—Ç–û—Ä–∏–Ω–≥. –í–∏–¥–∏–º–æ –ø–æ—Ç–æ–º—É, —á—Ç–æ –≤–æ–∑–Ω–∏–∫–ª–∏ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏ —Å–æ —Å–ª–æ–≤–æ–º ‚Äú—Ñ–∞–∫—Ç–æ—Ä–∏—è‚Äù, –∫–æ—Ç–æ—Ä–æ–µ —Å–ª—ã—à–∞–ª –≤ —Ñ–∏–ª—å–º–∞—Ö –ø—Ä–æ –¥–æ—Ä–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—É—é –†–æ—Å—Å–∏—é. –ú–µ–Ω—è –ø–æ–ø—Ä–∞–≤–∏–ª–∏. –í—Ä–æ–¥–µ –±—ã —Å—Ç–∞–ª –≥–æ–≤–æ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ, —Å —É–¥–∞—Ä–µ–Ω–∏–µ–º –Ω–∞ ‚Äú–∞‚Äù. –•–æ—Ç—è, –∏–Ω–æ–≥–¥–∞ –º–æ–∂–µ—Ç –ø—Ä–æ—Å–∫–æ–ª—å–∑–Ω—É—Ç—å —Å—Ç–∞—Ä—ã–π –≤–∞—Ä–∏–∞–Ω—Ç. –ù–∞–¥–µ—é—Å—å, —ç—Ç–æ –Ω–µ —Ç–∞–∫ —Ä–µ–∂–µ—Ç —Å–ª—É—Ö, –∫–∞–∫ –º–Ω–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–¥–∞—Ä–µ–Ω–∏–µ –≤ —Å–ª–æ–≤–∞—Ö ‚Äú–ø–æ–∑–≤–æ–Ω–∏–º‚Äù, ‚Äú—Å–æ–∑–≤–æ–Ω–∏–º—Å—è‚Äù –∏ —Ç.–ø. üòõ

–ò—Ç–∞–∫, –±–ª–∏–∂–µ –∫ –¥–µ–ª—É. –ò–º–µ–µ—Ç—Å—è –∫—É—Å–æ–∫ –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Ä–∞–∑–±–∏–µ–Ω–∏–µ–º —Ä–∞–±–æ—Ç—ã –Ω–∞ –ø–æ—Ä—Ü–∏–∏ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –∫ –Ω–∏–º —Ç–æ–≥–æ –∏–ª–∏ –∏–Ω–æ–≥–æ —ç–∫—à–µ–Ω–∞:  
  
\[csharp\]  
public static void BatchProcessing&lt;T&gt;(  
 this IEnumerable&lt;T&gt; list,  
 int batchSize,  
 Action&lt;IEnumerable&lt;T&gt;&gt; action)  
{  
 var data = list is List&lt;T&gt; ?  
 list as List&lt;T&gt; : list.ToList();  
 long total = data.Count;  
 int processed = 0;  
 while (data.Count &gt; 0)  
 {  
 int left = data.Count;  
 batchSize = left &gt; batchSize ? batchSize : left;  
 processed += batchSize;  
 var batchList = list.Take(batchSize).ToList();  
 data.RemoveRange(0, batchSize);  
 Trace.TraceInformation("Processed {0:0.00}% ‚Ä¶.",  
 (double)100 \* processed / total);  
 action(batchList);  
 }  
}  
\[/csharp\]

**–ö—Ä—É–≥ –ø–µ—Ä–≤—ã–π**

–ú–µ–Ω—è –¥–∞–Ω–Ω—ã–π –∫—É—Å–æ–∫ –∫–æ–¥–∞ –∑–∞—Ü–µ–ø–∏–ª, –ø—Ä–µ–∂–¥–µ –≤—Å–µ–≥–æ, —Å–≤–æ–µ–π –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–π –ø–æ—Ä—Ü–∏–∏, –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —ç–ª–µ–º–µ–Ω—Ç—ã —Å–ø–∏—Å–∫–∞ —Å–¥–≤–∏–≥–∞—é—Ç—Å—è –∫ –Ω—É–ª–µ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏. –£—á–∏—Ç—ã–≤–∞—è, —á—Ç–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –¥–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å–ø–∏—Å–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª–∏–Ω–æ–π –±–æ–ª–µ–µ –º–∏–ª–ª–∏–æ–Ω–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—è –∏—Ö –ø–æ 100 —à—Ç—É–∫ ‚Äì –ø–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–∏–ª–∏—è —Ç—Ä–∞—Ç—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–ø—É—Å—Ç—å —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–æ–∫, –Ω–æ –Ω–∞ –º–∏–ª–ª–∏–æ–Ω—ã –æ–±—ä–µ–∫—Ç–æ–≤). –Ø –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—é, —á—Ç–æ –ø—Ä–∏—á–∏–Ω–æ–π —ç—Ç–æ–≥–æ —è–≤–ª—è–µ—Ç—Å—è –ª—é–±–æ–≤—å –∞–≤—Ç–æ—Ä–∞ –∫–æ–¥–∞ –∫ LINQ, –ø–æ—ç—Ç–æ–º—É –æ–Ω –ø–æ–ø—ã—Ç–∞–ª—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, –∏—Å–ø–æ–ª—å–∑—É—è –µ–≥–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä Take().

–û—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äì –º–µ–ª–æ—á–∏. –ú–µ—Ç–æ–¥ –≤–µ–¥—å —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω. –ù–æ —Ç–∞–∫–∞—è –¥–∏–∫–∞—è –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–µ –¥–∞–≤–∞–ª–∞ –º–Ω–µ –ø–æ–∫–æ—è, –∏ —è –±—ã—Å—Ç—Ä–µ–Ω—å–∫–æ –Ω–∞–±—Ä–æ—Å–∞–ª –¥—Ä—É–≥–æ–π –≤–∞—Ä–∏–∞–Ω—Ç.

–°—Ç–æ–ø! –ß—Ç–æ-—Ç–æ —Å–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å. –ú–æ–∂–µ—Ç —á–µ–≥–æ-—Ç–æ –∑–∞–±—ã–ª? –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤—Å–µ –Ω–∞–∑–∞–¥ –∏ –¥–µ–ª–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ê –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚Äì –ø–æ–∫—Ä—ã—Ç—å –¥–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∞–º–∏. –ß—Ç–æ–±—ã –±—ã—Ç—å —É–≤–µ—Ä–µ–Ω–Ω—ã–º –≤ –Ω–µ–Ω–∞—Ä—É—à–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è. –ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å? –ê –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–º –Ω—É–∂–Ω–æ, —á—Ç–æ –º–µ—Ç–æ–¥ —Ä–∞–∑–±–∏–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ä—Ü–∏–π –∏ —á—Ç–æ –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑. –ü–µ—Ä–≤–æ–µ —É—Å–ª–æ–≤–∏–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º, –Ω–∞–∫–∞–ø–ª–∏–≤–∞—è –≤ —ç–∫—à–µ–Ω–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤, –∞ –≤—Ç–æ—Ä–æ–µ ‚Äì —Å—É–º–º–∏—Ä—É—è —Å—É–º–º—É —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫–∞–∂–¥–æ–π –ø–æ—Ä—Ü–∏–∏. –ò—Å—Ö–æ–¥—è –∏–∑ —Ç–æ–≥–æ, —á—Ç–æ —Å—É–º–º–∞ –æ–±–ª–∞–¥–∞–µ—Ç –∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å—é (–≤—Å–µ–º –∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–æ —à–∫–æ–ª—ã —Å–æ—á–µ—Ç–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–∫–æ–Ω), –Ω–µ –≤–∞–∂–Ω–æ, –≤ –∫–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ —Å—á–∏—Ç–∞—Ç—å —Å—É–º–º—É –∏ –∫–∞–∫ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ —ç—Ç–æ–º —ç–ª–µ–º–µ–Ω—Ç—ã. –í –ª—é–±–æ–º —Å–ª—É—á–∞–µ –º—ã –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

–ò—Ç–∞–∫, –≤–æ—Ç —Å–∞–º–∏ —Ç–µ—Å—Ç—ã:

\[csharp\]  
‚Ä¶  
private List&lt;int&gt; \_testSequence = null;  
‚Ä¶  
\[TestInitialize()\]  
public void MyTestInitialize()  
{  
 \_testSequence = (new int\[\]{1, 2, 3, 4, 5, 6, 7, 8,  
 9, 10, 11, 12, 13}).ToList();  
}  
‚Ä¶  
\[TestMethod()\]  
public void BatchProcessing\_TestPortionsCounting()  
{  
 int portionCounter = 0;  
 \_testSequence.ToArray().BatchProcessing(2,  
 x =&gt; portionCounter++);  
 Assert.AreEqual(7, portionCounter);

 portionCounter = 0;  
 \_testSequence.ToArray().BatchProcessing(1,  
 x =&gt; portionCounter++);  
 Assert.AreEqual(13, portionCounter);

 portionCounter = 0;  
 \_testSequence.ToArray().BatchProcessing(13,  
 x =&gt; portionCounter++);  
 Assert.AreEqual(1, portionCounter);

 portionCounter = 0;  
 \_testSequence.ToArray().BatchProcessing(100,  
 x =&gt; portionCounter++);  
 Assert.AreEqual(1, portionCounter);  
}

\[TestMethod()\]  
public void BatchProcessing\_TestEveryElementMustBePlacedOneTime()  
{  
 int expected = \_testSequence.Sum();  
 int sum = 0;

 \_testSequence.ToArray().BatchProcessing(2, x =&gt;  
 {  
 sum += x.Sum();  
 });  
 Assert.AreEqual(expected, sum, "Check 2");

 sum = 0;  
 \_testSequence.ToArray().BatchProcessing(1, x =&gt;  
 {  
 sum += x.Sum();  
 });  
 Assert.AreEqual(expected, sum, "Check 1");

 sum = 0;  
 \_testSequence.ToArray().BatchProcessing(13, x =&gt;  
 {  
 sum += x.Sum();  
 });  
 Assert.AreEqual(expected, sum, "Check 13");

 sum = 0;  
 \_testSequence.ToArray().BatchProcessing(100, x =&gt;  
 {  
 sum += x.Sum();  
 });  
 Assert.AreEqual(expected, sum, "Check 100");  
}  
\[/csharp\]

–¢—É—Ç –∫—É—á–∞ –ø–æ–≤—Ç–æ—Ä–æ–≤, —è –∑–Ω–∞—é, –Ω–æ –æ–± —ç—Ç–æ–º –Ω–∏–∂–µ.

–ú–∞–ª–µ–Ω—å–∫–æ–µ –ø–æ—è—Å–Ω–µ–Ω–∏–µ ‚Äì ToArray() –∫–∞–∂–¥—ã–π —Ä–∞–∑ —è –¥–µ–ª–∞—é –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤—ã–∑–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å—Ö–æ–¥–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏. –ú–∞–ª–æ –ª–∏ ‚Äì –º–æ–∂–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –µ—ë –ø–æ–¥–ø–æ—Ä—Ç–∏—Ç. –í–µ–¥—å —Ç–∞–º –µ—Å—Ç—å –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ —É–¥–∞–ª–µ–Ω–∏—è —á–∞—Å—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤.

–ó–∞–ø—É—Å–∫–∞–µ–º. –ü–µ—Ä–≤—ã–π —Ç–µ—Å—Ç, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–π –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ—Ä—Ü–∏–π —Ä–∞–±–æ—Ç—ã –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ê –≤–æ—Ç —Ç–µ—Å—Ç —Ç–æ–≥–æ, —á—Ç–æ –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑, —Ñ–µ–π–ª–∏—Ç!

–•–º, –≤ —á–µ–º –∂–µ –¥–µ–ª–æ? –ê –¥–µ–ª–æ –≤ –±–∞–Ω–∞–ª—å–Ω–æ–π –æ–ø–∏—Å–∫–µ. –î–∞–≤–∞–π—Ç–µ –≤–µ—Ä–Ω–µ–º—Å—è –∫ –ª–∏—Å—Ç–∏–Ω–≥—É –∏—Å—Ö–æ–¥–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–æ–∫—É:

\[csharp\]  
var batchList = list.Take(batchSize).ToList();  
\[/csharp\]

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º–µ—Ç–æ–¥ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –±–µ—Ä–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π data, –∞ –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ list. –£–¥–∞–ª—è—é—Ç—Å—è –∂–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ, —É data:

\[csharp\]  
data.RemoveRange(0, batchSize);  
\[/csharp\]

–£—Ö-—Ç—ã! –ö–∞–∫ –∂–µ —Ä–∞–Ω—å—à–µ –Ω–µ –∑–∞–º–µ—Ç–∏–ª–∏-—Ç–æ? –í–µ–¥—å –º–µ—Ç–æ–¥ —Ç—ã—Å—è—á–∏ —Ä–∞–∑ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª –æ–¥–Ω—É –∏ —Ç—É –∂–µ, –ø–µ—Ä–≤—É—é, –ø–æ—Ä—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö.

–ù—É –¥–∞ –ª–∞–¥–Ω–æ, –∑–∞–º–µ–Ω—è–µ–º list.Take‚Ä¶ –Ω–∞ data.Take‚Ä¶ ‚Äì —é–Ω–∏—Ç —Ç–µ—Å—Ç—ã —Ç–µ–ø–µ—Ä—å –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∫–∞–∫ –Ω–∞–¥–æ.

**–ö—Ä—É–≥ –≤—Ç–æ—Ä–æ–π.**

–ù—É, —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å. –í–æ—Ç –Ω–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:

\[csharp\]  
public static void BatchProcessing&lt;T&gt;(  
 this IEnumerable&lt;T&gt; list,  
 int batchSize,  
 Action&lt;IEnumerable&lt;T&gt;&gt; action)  
{  
 var data = list is List&lt;T&gt; ?  
 list as List&lt;T&gt; : list.ToList();  
 for (int i = 0; i &lt; data.Count; i += batchSize)  
 {  
 int currentPortionSize =  
 Math.Min(batchSize, data.Count ‚Äì i);  
 Trace.TraceInformation("Processed {0:0.00}% ‚Ä¶.",  
 (double)100 \* i / data.Count);  
 action(data.GetRange(i, currentPortionSize));  
 }  
}  
\[/csharp\]

–ö–æ—Ä–æ—Ç–∫–æ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ. –ë–µ–∑ —Å–¥–≤–∏–≥–æ–≤ –º–∏–ª–ª–∏–æ–Ω–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤. –Æ–Ω–∏—Ç —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç, –≤—Å–µ —Ö–æ—Ä–æ—à–æ.

–ù–æ –∫–∞–∫ –∂–µ –≤—Å–µ-—Ç–∞–∫–∏ –Ω–µ –∑–∞–º–µ—Ç–∏–ª–∏ —ç—Ç—É –æ—à–∏–±–∫—É —Ä–∞–Ω—å—à–µ???

–ê –¥–µ–ª–æ –≤–æ—Ç –≤ —á–µ–º:

\[csharp\]  
var data = list is List&lt;T&gt; ? list as List&lt;T&gt; : list.ToList();  
\[/csharp\]

–ò–º–µ—é—â–∏–π—Å—è –∫–æ–¥ –ø–µ—Ä–µ–¥–∞–≤–∞–ª –≤ –º–µ—Ç–æ–¥ List. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —à–ª–æ –ø–æ –≤–µ—Ç–∫–µ, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –∫–æ–ø–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫, –∞ –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –µ–≥–æ –∫ –Ω—É–∂–Ω–æ–º—É —Ç–∏–ø—É. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ, –º—ã –º–æ–∂–µ–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è —Ö–æ—Ç—å –∫ data, —Ö–æ—Ç—å –∫ list ‚Äì –º—ã –±—É–¥–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å —Å –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ –æ–±—ä–µ–∫—Ç–æ–º. –ò–º–µ–Ω–Ω–æ —ç—Ç–æ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–æ –∏ —Å–ø–∞—Å–∞–ª–æ.

**–ö—Ä—É–≥ —Ç—Ä–µ—Ç–∏–π.**

–ê, –≤ –æ–±—â–µ–º, –º—ã —Ç—É—Ç –Ω–∞–±–ª—é–¥–∞–µ–º –æ—Ç—Ö–æ–¥ –æ—Ç —Å—Ç—Ä–æ–≥–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–∏, –∑–∞ —á—Ç–æ –ø–æ–ø–ª–∞—Ç–∏–ª–∏—Å—å, –ø–æ–ª—É—á–∏–≤ –º–∏–Ω—É –∑–∞–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è. –û–Ω–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω –º–∞—Å—Å–∏–≤ (—Ç–∏—Ö–æ, –±–µ–∑–æ –≤—Å—è–∫–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è) –∏–ª–∏ Read-only —Å–ø–∏—Å–æ–∫ (—Ç—É—Ç —Ö–æ—Ç—è –±—ã —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∏–º —ç–∫—Å–µ–ø—à–µ–Ω). –≠—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–∏–ø –≤ —Ä–∞–Ω—Ç–∞–π–º–µ –ø–ª–æ—Ö–æ –ø–∞—Ö–Ω–µ—Ç. –£–π–¥–µ–º —Å —Ç–µ–º–Ω–æ–π –¥–æ—Ä–æ–≥–∏ –∏ –≤–µ—Ä–Ω–µ–º—Å—è –∫ —Å–∏–ª–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É—è –ø–µ—Ä–µ–≥—Ä—É–∑–∫—É:

\[csharp\]  
public static void BatchProcessing&lt;T&gt;(  
 this IEnumerable&lt;T&gt; list,  
 int batchSize,  
 Action&lt;IEnumerable&lt;T&gt;&gt; action)  
{  
 list.ToList().BatchProcessing(batchSize, action);  
}

public static void BatchProcessing&lt;T&gt;(  
 this List&lt;T&gt; list,  
 int batchSize,  
 Action&lt;IEnumerable&lt;T&gt;&gt; action)  
{  
 for (int i = 0; i &lt; list.Count; i += batchSize)  
 {  
 int currentPortionSize = Math.Min(batchSize,  
 list.Count ‚Äì i);  
 Trace.TraceInformation("Processed {0:0.00}% ‚Ä¶.",  
 (double)100 \* i / list.Count);  
 action(list.GetRange(i, currentPortionSize));  
 }  
}  
\[/csharp\]

–í–æ—Ç —Ç–µ–ø–µ—Ä—å, —è –¥–æ–≤–æ–ª–µ–Ω. –ö–∞–∫ –º–Ω–µ –∫–∞–∂–µ—Ç—Å—è, –∫–æ–¥ —Å—Ç–∞–ª –ø—Ä–æ—â–µ –∏ –ø–æ–Ω—è—Ç–Ω–µ–µ (–Ω–µ –≥–æ–≤–æ—Ä—è –ø—Ä–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å), –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ ‚Äú–º–∏–Ω–∞‚Äù. –ö–æ–Ω–µ—á–Ω–æ, –≤—Ç–æ—Ä–æ–π –º–µ—Ç–æ–¥ —Ç–æ–∂–µ –Ω—É–∂–Ω–æ ‚Äú–∑–∞–∫—Ä–µ–ø–∏—Ç—å‚Äù —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∞–º–∏. –ú–æ–π –ø–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Ç–µ—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –ø—Ä–∏–≤–µ–¥–µ–Ω –≤—ã—à–µ, –≥—Ä–µ—à–∏—Ç –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–º–∏—Å—è –∫–æ–¥–∞–º–∏ ‚Äì –æ—Å—Ç–∞–≤–ª—è—é –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –∏—Ö –≤ –∫–∞—á–µ—Å—Ç–≤–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –Ω–∞ —Ä–µ—Ñ–ê–∫—Ç–æ—Ä–∏–Ω–≥. –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ —è –∏—Ö –ø–æ–ø—Ä–∞–≤–∏–ª. –ò –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–æ–∂–Ω–æ –±—ã –¥–æ–±–∞–≤–∏—Ç—å ‚Äì —Ç—É—Ç, —è –∫–∞—é—Å—å, –æ—Å—Ç–∞–≤–∏–ª, –∫–∞–∫ –±—ã–ª–æ‚Ä¶

**–ú–æ—Ä–∞–ª—å‚Ä¶**

1\. –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã ‚Äì —ç—Ç–æ —Ö–æ—Ä–æ—à–æ. –û—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ, –Ω–æ –Ω–µ —Ç–æ–ª—å–∫–æ.  
2\. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –≤ —Ä–∞–Ω—Ç–∞–π–º–µ –±–µ–∑ –æ—Å–æ–±–æ–π –Ω—É–∂–¥—ã ‚Äì –ø–ª–æ—Ö–æ.  
3\. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ –º–∞–∫—Å–∏–º—É–º—É –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π —Å—Ç—Ä–æ–≥–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ ‚Äì —Ö–æ—Ä–æ—à–æ.